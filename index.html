<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MASSA PLAYGROUND</title>
    <meta name="description" content="Massa SC Playground.">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="stylesheet" href="index.css">
    <script async src="https://cdn.jsdelivr.net/npm/es-module-shims@1/dist/es-module-shims.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js">
    </script>
    <script type="importmap">
{
  "imports": {
    "binaryen": "https://cdn.jsdelivr.net/npm/binaryen@110.0.0/index.js",
    "long": "https://cdn.jsdelivr.net/npm/long@5.2.0/index.js",
    "assemblyscript": "https://cdn.jsdelivr.net/npm/assemblyscript@0.21.5/dist/assemblyscript.js",
    "assemblyscript/asc": "https://cdn.jsdelivr.net/npm/assemblyscript@0.21.5/dist/asc.js",
    "@massalabs/massa-as-sdk":"https://cdn.jsdelivr.net/npm/@massalabs/massa-as-sdk@1.1.0/assembly/index.ts"
  }
}
</script>



    <script type="module">
        import asc from "assemblyscript/asc";


        let consoleValue = ""

        // Set the Console Value 

        function setConsoleValue(message) {

            if (message == "clear") {
                consoleValue = ""
                $("#console").val("")
            }
            else {
                consoleValue = consoleValue + message
                $("#console").val(consoleValue)
            }
        }


        // Compile Smart Contract 


        let codeCompile = ""

        window.compileAS = async function (codeCompile) {
            codeCompile = $("#input-code").val();

            if (codeCompile == "") { codeCompile = "export function add(a: i32, b: i32): i32 {  return a + b;}" }

            const blob = new Blob([codeCompile], { type: "application/typescript" });
            console.log("blob ", blob)
            const url = URL.createObjectURL(blob);
            console.log("url ", url)


            // entryPoint of the compiled SC

            // const files = { "main.ts": `export function test(): void {}` };

            const files = {
                "main.ts": codeCompile,
                "node_modules/@massalabs/massa-as-sdk/assembly/index/index.ts": ""
            };
            const { error, stdout, stderr } = await asc.main(["main.ts", "--textFile"], {
                readFile: (name, baseDir) => {
                    console.log("readFile: " + name + ", baseDir=" + baseDir);
                    setConsoleValue("readFile: " + name + ", baseDir=" + baseDir)
                    if (Object.prototype.hasOwnProperty.call(files, name)) return files[name];
                    return null;
                },
                writeFile: (name, data, baseDir) => {
                    console.log("writeFile: " + name + ", baseDir=" + baseDir);
                    setConsoleValue("writeFile: " + name + ", baseDir=" + baseDir)
                },
                listFiles: (dirname, baseDir) => {
                    console.log("listFiles: " + dirname + ", baseDir=" + baseDir);
                    setConsoleValue("listFiles: " + dirname + ", baseDir=" + baseDir)
                    return [];
                },

            });
            if (error) {
                console.log("Compilation failed: " + error.message);
                setConsoleValue("Compilation failed: " + error.message)
                console.log(stderr.toString());
                setConsoleValue(stderr.toString())
            } else {
                console.log(stdout.toString());
                setConsoleValue(stdout.toString())
            }
        }


        window.handleClickCompile = () => { compileAS(codeCompile) }
        window.handleClickClear = () => { setConsoleValue("clear") }

    </script>

    <script>


        //Exporting written file



        let code = ""
        function exportTSfromText(code) {

            code = $("#input-code").val();
            if (code == "") { code = "export function add(a: i32, b: i32): i32 {  return a + b;}" }
            blob = new Blob([code], { type: "application/typescript" });
            url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.download = "code.ts";
            link.href = url;
            link.click();
        }
        const handleClickExport = () => { exportTSfromText(code) }






    </script>
</head>





<body>
    <div class="container">
        <h1>Massa SC Playground</h1>
        <div class="row">
            <textarea id="input-code"
                placeholder="export function add(a: i32, b: i32): i32 {  return a + b;}"></textarea>
            <div class="column">
                <button id="export-button" onclick=handleClickExport()>Export</button>
                <button id="compile-button" onclick=handleClickCompile()>Compile</button>
                <button id="clear-console" onclick=handleClickClear()> Clear Console</button>
            </div>
            <textarea disabled id="console" placeholder="console"></textarea>
        </div>


    </div>
</body>